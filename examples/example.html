<html>
<head>
  <meta charset="UTF-8">
  <title>jsQR</title>
  <script src="../dist/jsQR.js"></script>
</head>
<body style="text-align:center;">
  <h1 style="margin: 10px;">jsQR</h1>
  <div>
    <video id="video" autoplay="true"></video>
    <canvas id="canvas" style="width:640px; height:480px; display: none;"></canvas>
  </div>
  <script>
    var video = document.getElementById("video");
    var canvas = document.getElementById("canvas");
    var context = canvas.getContext("2d");

    var getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
    
    function successCallback(stream) {
      if (navigator.mediaDevices) {
        video.srcObject = stream;
      } else {
        if (window.webkitURL) {
          video.src = window.webkitURL.createObjectURL(stream);
        } else if (video.mozSrcObject !== undefined) {
          video.mozSrcObject = stream;
        } else {
          video.src = stream;
        }
      }
    }
    
    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
      navigator.mediaDevices.getUserMedia({video: true}).then(successCallback);
    } else {
      if (getUserMedia) {
        function errorCallback(){}
        navigator.getUserMedia({video: true}, successCallback, errorCallback);
      }
    }

    video.oncanplay = function() {
      requestAnimationFrame(tick);
    };

    function tick(){
      requestAnimationFrame(tick);

      var width = parseInt(video.videoWidth);
      var height = parseInt(video.videoHeight);
      canvas.width = width;
      canvas.height = height;
    
      context.drawImage(video, 0, 0, width, height);
      // Load the image data from the canvas
      var imageData = context.getImageData(0, 0, width, height);
      var decoded = jsQR.decodeQRFromImage(imageData.data, imageData.width, imageData.height);
      if(decoded) {
        alert(decoded);
      }
    }
  </script>
</body>
</html>
